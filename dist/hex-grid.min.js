var vg={VERSION:"0.1.1",PI:Math.PI,TAU:2*Math.PI,DEG_TO_RAD:.0174532925,RAD_TO_DEG:57.2957795,SQRT3:Math.sqrt(3),TILE:"tile",ENT:"entity",STR:"structure",HEX:"hex",SQR:"square",ABS:"abstract"},loader=new THREE.TextureLoader,tundra=loader.load("./image/tundra.jpg"),ice=loader.load("./image/ice.jpg"),sea=loader.load("./image/water.jpg"),sand=loader.load("./image/sand.jpg"),grassland=loader.load("./image/grassland.jpg"),hills=loader.load("./image/hills.jpg"),mountain=loader.load("./image/mountains.jpg");vg.Board=function(t,e){if(!t)throw new Error("You must pass in a grid system for the board to use.");this.tiles=[],this.tileGroup=null,this.group=new THREE.Object3D,this.grid=null,this.overlay=null,this.finder=new vg.AStarFinder(e),vg.Loader.init(),this.setGrid(t)},vg.Board.prototype={setEntityOnTile:function(t,e){var i=this.grid.cellToPixel(e.cell);t.position.copy(i),t.position.y+=t.heightOffset||0,t.tile&&(t.tile.entity=null),(t.tile=e).entity=t},addTile:function(t){-1===this.tiles.indexOf(t)&&(this.tiles.push(t),this.snapTileToGrid(t),t.position.y=0,this.tileGroup.add(t.mesh),this.grid.add(t.cell),t.cell.tile=t)},removeTile:function(t){var e;t&&(e=this.tiles.indexOf(t),this.grid.remove(t.cell),-1!==e&&this.tiles.splice(e,1),t.dispose())},removeAllTiles:function(){if(this.tileGroup)for(var t=this.tileGroup.children,e=0;e<t.length;e++)this.tileGroup.remove(t[e])},getTileAtCell:function(t){var e=this.grid.cellToHash(t);return t.tile||(void 0!==this.grid.cells[e]?this.grid.cells[e].tile:null)},snapToGrid:function(t){var e=this.grid.pixelToCell(t);t.copy(this.grid.cellToPixel(e))},snapTileToGrid:function(t){var e;return t.cell?t.position.copy(this.grid.cellToPixel(t.cell)):(e=this.grid.pixelToCell(t.position),t.position.copy(this.grid.cellToPixel(e))),t},getRandomTile:function(){var t=vg.Tools.randomInt(0,this.tiles.length-1);return this.tiles[t]},findPath:function(t,e,i){return this.finder.findPath(t.cell,e.cell,i,this.grid)},setGrid:function(t){this.group.remove(this.tileGroup),this.grid&&t!==this.grid&&(this.removeAllTiles(),this.tiles.forEach(function(t){this.grid.remove(t.cell),t.dispose()}),this.grid.dispose()),this.grid=t,this.tiles=[],this.tileGroup=new THREE.Object3D,this.group.add(this.tileGroup)},generateOverlay:function(t){var e=new THREE.LineBasicMaterial({color:0,opacity:.3});this.overlay&&this.group.remove(this.overlay),this.overlay=new THREE.Object3D,this.grid.generateOverlay(t,this.overlay,e),this.group.add(this.overlay)},generateTilemap:function(t){this.reset();var e=this.grid.generateTiles(t);this.tiles=e,this.tileGroup=new THREE.Object3D;for(var i=0;i<e.length;i++)this.tileGroup.add(e[i].mesh);this.group.add(this.tileGroup)},reset:function(){this.removeAllTiles(),this.tileGroup&&this.group.remove(this.tileGroup)}},vg.Board.prototype.constructor=vg.Board,vg.Cell=function(t,e,i,s){this.q=t||0,this.r=e||0,this.s=i||0,this.h=s||1,this.tile=null,this.userData={},this.walkable=!0,this._calcCost=0,this._priority=0,this._visited=!1,this._parent=null,this.uniqueID=vg.LinkedList.generateID()},vg.Cell.prototype={set:function(t,e,i){return this.q=t,this.r=e,this.s=i,this},copy:function(t){return this.q=t.q,this.r=t.r,this.s=t.s,this.h=t.h,this.tile=t.tile||null,this.userData=t.userData||{},this.walkable=t.walkable,this},add:function(t){return this.q+=t.q,this.r+=t.r,this.s+=t.s,this},equals:function(t){return this.q===t.q&&this.r===t.r&&this.s===t.s}},vg.Cell.prototype.constructor=vg.Cell,vg.HexGrid=function(t){t=t||{},this.type=vg.HEX,this.size=5,this.cellSize=void 0===t.cellSize?10:t.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;for(var e=[],i=0;i<6;i++)e.push(this._createVertex(i));for(this.cellShape=new THREE.Shape,this.cellShape.moveTo(e[0].x,e[0].y),i=1;i<6;i++)this.cellShape.lineTo(e[i].x,e[i].y);this.cellShape.lineTo(e[0].x,e[0].y),this.cellShape.autoClose=!0,this.cellGeo=new THREE.Geometry,this.cellGeo.vertices=e,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new THREE.ShapeGeometry(this.cellShape),this._cellWidth=2*this.cellSize,this._cellLength=.5*vg.SQRT3*this._cellWidth,this._hashDelimeter=".",this._directions=[new vg.Cell(1,-1,0),new vg.Cell(1,0,-1),new vg.Cell(0,1,-1),new vg.Cell(-1,1,0),new vg.Cell(-1,0,1),new vg.Cell(0,-1,1)],this._diagonals=[new vg.Cell(2,-1,-1),new vg.Cell(1,1,-2),new vg.Cell(-1,2,-1),new vg.Cell(-2,1,1),new vg.Cell(-1,-1,2),new vg.Cell(1,-2,1)],this._list=[],this._vec3=new THREE.Vector3,this._cel=new vg.Cell,this._conversionVec=new THREE.Vector3,this._geoCache=[],this._matCache=[]},vg.HexGrid.TWO_THIRDS=2/3,vg.HexGrid.prototype={cellToPixel:function(t){return this._vec3.x=t.q*this._cellWidth*.75,this._vec3.y=t.h,this._vec3.z=-((t.s-t.r)*this._cellLength)*.5,this._vec3},pixelToCell:function(t){var e=t.x*(vg.HexGrid.TWO_THIRDS/this.cellSize),t=(-t.x/3+vg.SQRT3/3*t.z)/this.cellSize;return this._cel.set(e,t,-e-t),this._cubeRound(this._cel)},getCellAt:function(t){var e=t.x*(vg.HexGrid.TWO_THIRDS/this.cellSize),t=(-t.x/3+vg.SQRT3/3*t.z)/this.cellSize;return this._cel.set(e,t,-e-t),this._cubeRound(this._cel),this.cells[this.cellToHash(this._cel)]},getNeighbors:function(t,e,i){for(var s,n=this._directions.length,r=this._list.length=0;r<n;r++)this._cel.copy(t),this._cel.add(this._directions[r]),!(s=this.cells[this.cellToHash(this._cel)])||i&&!i(t,s)||this._list.push(s);if(e)for(r=0;r<n;r++)this._cel.copy(t),this._cel.add(this._diagonals[r]),!(s=this.cells[this.cellToHash(this._cel)])||i&&!i(t,s)||this._list.push(s);return this._list},getRandomCell:function(){var t,e=0,i=vg.Tools.randomInt(0,this.numCells);for(t in this.cells){if(e===i)return this.cells[t];e++}return this.cells[t]},cellToHash:function(t){return t.q+this._hashDelimeter+t.r+this._hashDelimeter+t.s},distance:function(t,e){var i=Math.max(Math.abs(t.q-e.q),Math.abs(t.r-e.r),Math.abs(t.s-e.s));return i+=e.h-t.h},clearPath:function(){var t,e;for(t in this.cells)(e=this.cells[t])._calcCost=0,e._priority=0,e._parent=null,e._visited=!1},traverse:function(t){for(var e in this.cells)t(this.cells[e])},generateTile:function(t,e,i){var s=Math.abs(t.h),n=this._geoCache[s=s<1?1:s];n||(this.extrudeSettings.depth=s,n=new THREE.ExtrudeGeometry(this.cellShape,this.extrudeSettings),this._geoCache[s]=n);i=new vg.Tile({size:this.cellSize,scale:e,cell:t,geometry:n,material:i});return t.tile=i},generateTiles:function(t){var e,i,s,n=[],r={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{depth:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:this.cellSize/20,bevelThickness:this.cellSize/20}},r=vg.Tools.merge(r,t=t||{});for(e in this.cellSize=r.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*vg.SQRT3*this._cellWidth,this.autogenerated=!0,this.extrudeSettings=r.extrudeSettings,this.cells)s=this.cells[e],(i=this.generateTile(s,r.tileScale,r.material)).position.copy(this.cellToPixel(s)),i.position.y=0,n.push(i);return n},generateTilePoly:function(t){t=t||new THREE.MeshBasicMaterial({color:2405631});t=new THREE.Mesh(this.cellShapeGeo,t);return this._vec3.set(1,0,0),t.rotateOnAxis(this._vec3,vg.PI/2),t},generate:function(t){var e,i,s;for(this.size=(void 0===(t=t||{}).size?this:t).size,e=-this.size;e<this.size+1;e++)for(i=-this.size;i<this.size+1;i++)s=-e-i,Math.abs(e)<=this.size&&Math.abs(i)<=this.size&&Math.abs(s)<=this.size&&(s=new vg.Cell(e,i,s),this.add(s))},generateOverlay:function(t,e,i){for(var s,n=this.cellShape.createPointsGeometry(),r=-t;r<t+1;r++)for(s=-t;s<t+1;s++){var o=-r-s;Math.abs(r)<=t&&Math.abs(s)<=t&&Math.abs(o)<=t&&(this._cel.set(r,s,o),(o=new THREE.Line(n,i)).position.copy(this.cellToPixel(this._cel)),o.rotation.x=90*vg.DEG_TO_RAD,e.add(o))}},add:function(t){var e=this.cellToHash(t);if(!this.cells[e])return this.cells[e]=t,this.numCells++,t},remove:function(t){t=this.cellToHash(t);this.cells[t]&&(delete this.cells[t],this.numCells--)},dispose:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null},load:function(t,e,i){var s=this;vg.Tools.getJSON({url:t,callback:function(t){s.fromJSON(t),e.call(i||null,t)},cache:!1,scope:s})},fromJSON:function(t){var e,i,s=t.cells;for(this.cells={},this.numCells=0,this.size=t.size,this.cellSize=t.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*vg.SQRT3*this._cellWidth,this.extrudeSettings=t.extrudeSettings,this.autogenerated=t.autogenerated,e=0;e<s.length;e++)(i=new vg.Cell).copy(s[e]),this.add(i)},toJSON:function(){var t,e,i={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},s=[];for(e in this.cells)t=this.cells[e],s.push({q:t.q,r:t.r,s:t.s,h:t.h,walkable:t.walkable,userData:t.userData});return i.cells=s,i},_createVertex:function(t){t=vg.TAU/6*t;return new THREE.Vector3(this.cellSize*Math.cos(t),this.cellSize*Math.sin(t),0)},_cubeRound:function(t){var e=Math.round(t.q),i=Math.round(t.r),s=Math.round(t.s),n=Math.abs(e-t.q),r=Math.abs(i-t.r),t=Math.abs(s-t.s);return r<n&&t<n?e=-i-s:t<r?i=-e-s:s=-e-i,this._cel.set(e,i,s)}},vg.HexGrid.prototype.constructor=vg.HexGrid,vg.Tile=function(t){var e={cell:null,geometry:null,material:null};if(!(e=vg.Tools.merge(e,t=t||{})).cell||!e.geometry)throw new Error("Missing vg.Tile configuration");if(this.cell=e.cell,this.cell.tile&&this.cell.tile!==this&&this.cell.tile.dispose(),(this.cell.tile=this).uniqueID=vg.Tools.generateID(),this.geometry=e.geometry,this.material=e.material,!this.material){switch(this.cell.tile.cell.userData.type){case"Tundra":texture=tundra;break;case"Ice":texture=ice;break;case"Sea":texture=sea;break;case"Sand":texture=sand;break;case"Grassland":texture=grassland;break;case"Hills":texture=hills;break;case"Mountain":texture=mountain}this.material=new THREE.MeshPhongMaterial({map:texture}),texture.wrapS=texture.wrapT=THREE.RepeatWrapping}this.objectType=vg.TILE,this.entity=null,this.userData={},this.selected=!1,this.highlight="0x0084cc",this.mesh=new THREE.Mesh(this.geometry,this.material),(this.mesh.userData.structure=this).position=this.mesh.position,this.rotation=this.mesh.rotation,this.rotation.x=-90*vg.DEG_TO_RAD,this.mesh.scale.set(e.scale,e.scale,1),this.material.emissive?this._emissive=this.material.emissive.getHex():this._emissive=null},vg.Tile.prototype={select:function(){return this.material.emissive&&this.material.emissive.setHex(this.highlight),this.selected=!0,this},deselect:function(){return null!==this._emissive&&this.material.emissive&&this.material.emissive.setHex(this._emissive),this.selected=!1,this},toggle:function(){return this.selected?this.deselect():this.select(),this},dispose:function(){this.cell&&this.cell.tile&&(this.cell.tile=null),this.cell=null,this.position=null,this.rotation=null,this.mesh.parent&&this.mesh.parent.remove(this.mesh),this.mesh.userData.structure=null,this.mesh=null,this.material=null,this.userData=null,this.entity=null,this.geometry=null,this._emissive=null}},vg.Tile.prototype.constructor=vg.Tile,function(){function i(){this.obj=null,this.next=null,this.prev=null,this.free=!0}function s(){this.first=null,this.last=null,this.length=0,this.objToNodeMap={},this.uniqueID=Date.now()+""+Math.floor(1e3*Math.random()),this.sortArray=[]}s.generateID=function(){return Math.random().toString(36).slice(2)+Date.now()},vg.LinkedList=(s.prototype={getNode:function(t){return this.objToNodeMap[t.uniqueID]},addNode:function(t){var e=new i;if(!t.uniqueID)try{t.uniqueID=s.generateID()}catch(t){return console.error("[LinkedList.addNode] obj passed is immutable: cannot attach necessary identifier"),null}return e.obj=t,e.free=!1,this.objToNodeMap[t.uniqueID]=e},swapObjects:function(t,e){this.objToNodeMap[t.obj.uniqueID]=null,(this.objToNodeMap[e.uniqueID]=t).obj=e},add:function(t){var e=this.objToNodeMap[t.uniqueID];if(e){if(!1===e.free)return;e.obj=t,e.free=!1,e.next=null,e.prev=null}else e=this.addNode(t);if(this.first){if(!this.last)throw new Error("[LinkedList.add] No last in the list -- that shouldn't happen here");(this.last.next=e).prev=this.last,(this.last=e).next=null}else this.first=e,(this.last=e).next=null,e.prev=null;this.length++,this.showDebug&&this.dump("after add")},has:function(t){return!!this.objToNodeMap[t.uniqueID]},moveUp:function(t){this.dump("before move up");var e,i,s=this.getNode(t);if(!s)throw"Oops, trying to move an object that isn't in the list";s.prev&&(i=(e=s.prev).prev,s==this.last&&(this.last=e),t=s.next,i&&(i.next=s),s.next=e,s.prev=e.prev,e.next=t,e.prev=s,this.first==e&&(this.first=s))},moveDown:function(t){var e=this.getNode(t);if(!e)throw"Oops, trying to move an object that isn't in the list";e.next&&(t=e.next,this.moveUp(t.obj),this.last==t&&(this.last=e))},sort:function(t){var e,i,s=this.sortArray,n=this.first;for(s.length=0;n;)s.push(n.obj),n=n.next;for(this.clear(),s.sort(t),i=s.length,e=0;e<i;e++)this.add(s[e])},remove:function(t){t=this.getNode(t);return!(!t||t.free)&&(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.prev||(this.first=t.next),t.next||(this.last=t.prev),t.free=!0,t.prev=null,t.next=null,this.length--,!0)},shift:function(){var t=this.first;return 0===this.length?null:(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this.first=t.next,t.next||(this.last=null),t.free=!0,t.prev=null,t.next=null,this.length--,t.obj)},pop:function(){var t=this.last;return 0===this.length?null:(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this.last=t.prev,t.prev||(this.first=null),t.free=!0,t.prev=null,t.next=null,this.length--,t.obj)},concat:function(t){for(var e=t.first;e;)this.add(e.obj),e=e.next},clear:function(){for(var t=this.first;t;)t.free=!0,t=t.next;this.first=null,this.length=0},dispose:function(){for(var t=this.first;t;)t.obj=null,t=t.next;this.first=null,this.objToNodeMap=null},dump:function(t){console.log("===================="+t+"=====================");for(var e=this.first;e;)console.log("{"+e.obj.toString()+"} previous="+(e.prev?e.prev.obj:"NULL")),e=e.next();console.log("==================================="),console.log("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}}).constructor=s}(),function(){function o(t,e,i,s,n){this._listener=e,this.isOnce=i,this.context=s,this.signal=t,this._priority=n||0}(o.prototype={active:!0,params:null,execute:function(t){var e;return this.active&&this._listener&&(e=this.params?this.params.concat(t):t,e=this._listener.apply(this.context,e),this.isOnce&&this.detach()),e},detach:function(){return this.isBound()?this.signal.remove(this._listener,this.context):null},isBound:function(){return!!this.signal&&!!this._listener},_destroy:function(){delete this.signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this.isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}}).constructor=o;var e=function(){this._bindings=[],this._prevParams=null;var t=this;this.dispatch=function(){e.prototype.dispatch.apply(t,arguments)}};e.prototype={memorize:!1,_shouldPropagate:!0,active:!0,validateListener:function(t,e){if("function"!=typeof t)throw new Error("Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))},_registerListener:function(t,e,i,s){var n,r=this._indexOfListener(t,i);if(-1!==r){if((n=this._bindings[r]).isOnce!==e)throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else n=new o(this,t,e,i,s),this._addBinding(n);return this.memorize&&this._prevParams&&n.execute(this._prevParams),n},_addBinding:function(t){for(var e=this._bindings.length;e--,this._bindings[e]&&t._priority<=this._bindings[e]._priority;);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){for(var i,s=this._bindings.length;s--;)if((i=this._bindings[s])._listener===t&&i.context===e)return s;return-1},has:function(t,e){return-1!==this._indexOfListener(t,e)},add:function(t,e,i){return this.validateListener(t,"add"),this._registerListener(t,!1,e,i)},addOnce:function(t,e,i){return this.validateListener(t,"addOnce"),this._registerListener(t,!0,e,i)},remove:function(t,e){this.validateListener(t,"remove");e=this._indexOfListener(t,e);return-1!==e&&(this._bindings[e]._destroy(),this._bindings.splice(e,1)),t},removeAll:function(t){void 0===t&&(t=null);for(var e=this._bindings.length;e--;)t?this._bindings[e].context===t&&(this._bindings[e]._destroy(),this._bindings.splice(e,1)):this._bindings[e]._destroy();t||(this._bindings.length=0)},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var t,e=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=e),i)for(t=this._bindings.slice(),this._shouldPropagate=!0;i--,t[i]&&this._shouldPropagate&&!1!==t[i].execute(e););}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},e.prototype.constructor=e,vg.Signal=e}(),vg.AStarFinder=function(t){var e=vg.Tools.merge(e={allowDiagonal:!1,heuristicFilter:null},t=t||{});this.allowDiagonal=e.allowDiagonal,this.heuristicFilter=e.heuristicFilter,this.list=new vg.LinkedList},vg.AStarFinder.prototype={findPath:function(t,e,i,s){var n,r,o,h,l,a;for(i=i||this.heuristicFilter,s.clearPath(),this.list.clear(),this.list.add(t);0<this.list.length;){if(this.list.sort(this.compare),(n=this.list.shift())._visited=!0,n===e)return vg.PathUtil.backtrace(e);for(l=0,a=(o=s.getNeighbors(n,this.allowDiagonal,i)).length;l<a;l++)if(h=o[l],h.walkable&&(r=n._calcCost+s.distance(n,h),!h._visited||r<h._calcCost)){if(h._visited=!0,h._parent=n,h._calcCost=r,h._priority=r+s.distance(e,h),h===e)return vg.PathUtil.backtrace(e);this.list.add(h)}}return null},compare:function(t,e){return t._priority-e._priority}},vg.AStarFinder.prototype.constructor=vg.AStarFinder,vg.PathUtil={backtrace:function(t){for(var e=[t];t._parent;)t=t._parent,e.push(t);return e.reverse()},biBacktrace:function(t,e){t=this.backtrace(t),e=this.backtrace(e);return t.concat(e.reverse())},pathLength:function(t){for(var e,i,s,n=0,r=1;r<t.length;++r)e=t[r-1],s=t[r],i=e[0]-s[0],s=e[1]-s[1],n+=Math.sqrt(i*i+s*s);return n},interpolate:function(t,e,i,s){for(var n,r=Math.abs,o=[],h=r(i-t),l=r(s-e),a=t<i?1:-1,c=e<s?1:-1,u=h-l;t!==i||e!==s;)o.push([t,e]),-l<(n=2*u)&&(u-=l,t+=a),n<h&&(u+=h,e+=c);return o},expandPath:function(t){var e,i,s,n,r,o,h=[],l=t.length;if(l<2)return h;for(r=0;r<l-1;++r)for(e=t[r],i=t[r+1],n=(s=this.interpolate(e[0],e[1],i[0],i[1])).length,o=0;o<n-1;++o)h.push(s[o]);return h.push(t[l-1]),h},smoothenPath:function(t,e){for(var i,s,n,r,o,h,l=e.length,a=e[0][0],c=e[0][1],u=e[l-1][0],d=e[l-1][1],g=a,p=c,v=[[g,p]],f=2;f<l;++f){for(i=(n=e[f])[0],n=n[1],r=this.interpolate(g,p,i,n),h=!1,s=1;s<r.length;++s)if(o=r[s],!t.isWalkableAt(o[0],o[1])){h=!0;break}h&&(n=e[f-1],v.push(n),g=n[0],p=n[1])}return v.push([u,d]),v},compressPath:function(t){if(t.length<3)return t;var e,i,s,n,r,o=[],h=t[0][0],l=t[0][1],a=t[1][0],c=t[1][1],u=a-h,d=c-l,g=Math.sqrt(u*u+d*d);for(u/=g,d/=g,o.push([h,l]),r=2;r<t.length;r++)e=a,i=c,s=u,n=d,u=(a=t[r][0])-e,d=(c=t[r][1])-i,d/=g=Math.sqrt(u*u+d*d),(u/=g)===s&&d===n||o.push([e,i]);return o.push([a,c]),o}},vg.Loader={manager:null,imageLoader:null,crossOrigin:!1,init:function(t){this.crossOrigin=t||!1,this.manager=new THREE.LoadingManager(function(){},function(){},function(){console.warn("Error loading images")}),this.imageLoader=new THREE.ImageLoader(this.manager),this.imageLoader.crossOrigin=t},loadTexture:function(t,e,i,s){var n=new THREE.Texture(null,e);return this.imageLoader.load(t,function(t){n.image=t,n.needsUpdate=!0,i&&i(n)},null,function(t){s&&s(t)}),n.sourceFile=t,n}},vg.MouseCaster=function(t,e,i){this.down=!1,this.rightDown=!1,this.pickedObject=null,this.selectedObject=null,this.allHits=null,this.active=!0,this.shift=!1,this.ctrl=!1,this.wheel=0,this.position=new THREE.Vector3,this.screenPosition=new THREE.Vector2,this.signal=new vg.Signal,this.group=t,this._camera=e,this._raycaster=new THREE.Raycaster,this._preventDefault=!1,(i=i||document).addEventListener("mousemove",this._onDocumentMouseMove.bind(this),!1),i.addEventListener("mousedown",this._onDocumentMouseDown.bind(this),!1),i.addEventListener("mouseup",this._onDocumentMouseUp.bind(this),!1),i.addEventListener("mousewheel",this._onMouseWheel.bind(this),!1),i.addEventListener("DOMMouseScroll",this._onMouseWheel.bind(this),!1)},vg.MouseCaster.OVER="over",vg.MouseCaster.OUT="out",vg.MouseCaster.DOWN="down",vg.MouseCaster.UP="up",vg.MouseCaster.CLICK="click",vg.MouseCaster.WHEEL="wheel",vg.MouseCaster.prototype={update:function(){var t,e,i;this.active&&(this._raycaster.setFromCamera(this.screenPosition,this._camera),0<(t=this._raycaster.intersectObject(this.group,!0)).length?(i=(e=t[0]).object.userData.structure,this.pickedObject!=i&&(this.pickedObject&&this.signal.dispatch(vg.MouseCaster.OUT,this.pickedObject),this.pickedObject=i,this.selectedObject=null,this.signal.dispatch(vg.MouseCaster.OVER,this.pickedObject)),this.position.copy(e.point),this.screenPosition.z=e.distance):(this.pickedObject&&this.signal.dispatch(vg.MouseCaster.OUT,this.pickedObject),this.pickedObject=null,this.selectedObject=null),this.allHits=t)},preventDefault:function(){this._preventDefault=!0},_onDocumentMouseDown:function(t){if(this.active){if((t=t||window.event).preventDefault(),this._preventDefault)return this._preventDefault=!1;this.pickedObject&&(this.selectedObject=this.pickedObject),this.shift=t.shiftKey,this.ctrl=t.ctrlKey,this.down=1===t.which,this.rightDown=3===t.which,this.signal.dispatch(vg.MouseCaster.DOWN,this.pickedObject)}},_onDocumentMouseUp:function(t){if(this.active){if(t.preventDefault(),this._preventDefault)return this._preventDefault=!1;this.shift=t.shiftKey,this.ctrl=t.ctrlKey,this.signal.dispatch(vg.MouseCaster.UP,this.pickedObject),this.selectedObject&&this.pickedObject&&this.selectedObject.uniqueID===this.pickedObject.uniqueID&&this.signal.dispatch(vg.MouseCaster.CLICK,this.pickedObject),this.down=1!==t.which&&this.down,this.rightDown=3!==t.which&&this.rightDown}},_onDocumentMouseMove:function(t){this.active&&(t.preventDefault(),this.screenPosition.x=t.clientX/window.innerWidth*2-1,this.screenPosition.y=2*-(t.clientY/window.innerHeight)+1)},_onMouseWheel:function(t){var e;this.active&&(t.preventDefault(),t.stopPropagation(),void(e=0)!==t.wheelDelta?e=t.wheelDelta:void 0!==t.detail&&(e=-t.detail),0<e?this.wheel++:this.wheel--,this.signal.dispatch(vg.MouseCaster.WHEEL,this.wheel))}},vg.MouseCaster.prototype.constructor=vg.MouseCaster,vg.Scene=function(t,e){var i,s={element:document.body,alpha:!0,antialias:!0,clearColor:"#fff",sortObjects:!1,fog:null,light:new THREE.DirectionalLight(16777215),lightPosition:null,cameraType:"PerspectiveCamera",cameraPosition:null,orthoZoom:4},n={minDistance:100,maxDistance:1e3,zoomSpeed:2,noZoom:!1},s=vg.Tools.merge(s,t);"boolean"!=typeof e&&(n=vg.Tools.merge(n,e)),this.renderer=new THREE.WebGLRenderer({alpha:s.alpha,antialias:s.antialias}),this.renderer.setClearColor(s.clearColor,0),this.renderer.sortObjects=s.sortObjects,this.width=window.innerWidth,this.height=window.innerHeight,this.orthoZoom=s.orthoZoom,this.container=new THREE.Scene,this.container.fog=s.fog,this.container.add(new THREE.AmbientLight(14540253)),s.lightPosition||s.light.position.set(-1,1,-1).normalize(),this.container.add(s.light),"OrthographicCamera"===s.cameraType?(i=window.innerWidth/this.orthoZoom,t=window.innerHeight/this.orthoZoom,this.camera=new THREE.OrthographicCamera(i/-2,i/2,t/2,t/-2,1,5e3)):this.camera=new THREE.PerspectiveCamera(50,this.width/this.height,1,5e3),this.contolled=!!e,this.contolled&&(this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.minDistance=n.minDistance,this.controls.maxDistance=n.maxDistance,this.controls.zoomSpeed=n.zoomSpeed,this.controls.noZoom=n.noZoom),s.cameraPosition&&this.camera.position.copy(s.cameraPosition),window.addEventListener("resize",function(){var t,e;this.width=window.innerWidth,this.height=window.innerHeight,"OrthographicCamera"===this.camera.type?(t=this.width/this.orthoZoom,e=this.height/this.orthoZoom,this.camera.left=t/-2,this.camera.right=t/2,this.camera.top=e/2,this.camera.bottom=e/-2):this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)}.bind(this),!1),this.attachTo(s.element)},vg.Scene.prototype={attachTo:function(t){t.style.width=this.width+"px",t.style.height=this.height+"px",this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),t.appendChild(this.renderer.domElement)},add:function(t){this.container.add(t)},remove:function(t){this.container.remove(t)},render:function(){this.contolled&&this.controls.update(),this.renderer.render(this.container,this.camera)},updateOrthoZoom:function(){var t,e;this.orthoZoom<=0?this.orthoZoom=0:(t=this.width/this.orthoZoom,e=this.height/this.orthoZoom,this.camera.left=t/-2,this.camera.right=t/2,this.camera.top=e/2,this.camera.bottom=e/-2,this.camera.updateProjectionMatrix())},focusOn:function(t){this.camera.lookAt(t.position)}},vg.Scene.prototype.constructor=vg.Scene,vg.SelectionManager=function(t){this.mouse=t,this.onSelect=new vg.Signal,this.onDeselect=new vg.Signal,this.selected=null,this.toggleSelection=!1,this.mouse.signal.add(this.onMouse,this)},vg.SelectionManager.prototype={select:function(t,e){t&&(e=e||!0,this.selected!==t&&this.clearSelection(e),t.selected?this.toggleSelection&&(e&&this.onDeselect.dispatch(t),t.deselect()):t.select(),this.selected=t,e&&this.onSelect.dispatch(t))},clearSelection:function(t){t=t||!0,this.selected&&(t&&this.onDeselect.dispatch(this.selected),this.selected.deselect()),this.selected=null},onMouse:function(t,e){switch(t){case vg.MouseCaster.DOWN:e||this.clearSelection();break;case vg.MouseCaster.CLICK:this.select(e)}}},vg.SelectionManager.prototype.constructor=vg.SelectionManager,vg.Tools={clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},sign:function(t){return t&&t/Math.abs(t)},random:function(t,e){return 1===arguments.length?Math.random()*t-.5*t:Math.random()*(e-t)+t},randomInt:function(t,e){return 1===arguments.length?Math.random()*t-.5*t|0:Math.random()*(e-t+1)+t|0},normalize:function(t,e,i){return(t-e)/(i-e)},getShortRotation:function(t){return(t%=this.TAU)>this.PI?t-=this.TAU:t<-this.PI&&(t+=this.TAU),t},generateID:function(){return Math.random().toString(36).slice(2)+Date.now()},isPlainObject:function(t){if("object"!=typeof t||t.nodeType||t===t.window)return!1;try{if(t.constructor&&!Object.prototype.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},merge:function(i,e){var s=this,t=Array.isArray(e),n=t?[]:{};return t?(n=n.concat(i=i||[]),e.forEach(function(t,e){void 0===n[e]?n[e]=t:s.isPlainObject(t)?n[e]=s.merge(i[e],t):-1===i.indexOf(t)&&n.push(t)})):(i&&s.isPlainObject(i)&&Object.keys(i).forEach(function(t){n[t]=i[t]}),Object.keys(e).forEach(function(t){e[t]&&s.isPlainObject(e[t])&&i[t]?n[t]=s.merge(i[t],e[t]):n[t]=e[t]})),n},now:function(){return window.nwf?window.nwf.system.Performance.elapsedTime:window.performance.now()},empty:function(t){for(;t.lastChild;)t.removeChild(t.lastChild)},radixSort:function(t,e,i,s){if(s=s||31,!((i=i||t.length)-1<=(e=e||0)||s<0)){for(var n,r=e,o=i,h=1<<s;r<o;)t[r]&h?(--o,n=t[r],t[r]=t[o],t[o]=n):++r;this.radixSort(t,e,o,s-1),this.radixSort(t,o,i,s-1)}},randomizeRGB:function(t,e){var i,s,n=t.split(","),r="rgb(";for(e=this.randomInt(e),i=0;i<3;i++)(s=parseInt(n[i])+e)<0?s=0:255<s&&(s=255),r+=s+",";return r=r.substring(0,r.length-1),r+=")"},getJSON:function(e){var t=new XMLHttpRequest,i=void 0!==e.cache&&e.cache?e.url:e.url+"?t="+Math.floor(1e4*Math.random())+Date.now();t.onreadystatechange=function(){if(200===this.status){var t=null;try{t=JSON.parse(this.responseText)}catch(t){return}e.callback.call(e.scope||null,t)}else 0!==this.status&&console.warn("[Tools.getJSON] Error: "+this.status+" ("+this.statusText+") :: "+e.url)},t.open("GET",i,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/json"),t.send("")}};
//# sourceMappingURL=hex-grid.min.js.map
